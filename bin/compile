#!/bin/sh

echo ">>>>> into compile shell"

DIR_BUILD=${1:-}
DIR_CACHE=${2:-}
DIR_ENV=${3:-}

echo DIR_BUILD=$DIR_BUILD
echo DIR_CACHE=$DIR_CACHE
echo DIR_ENV=$DIR_ENV

RUSTUP_HOME="$DIR_CACHE/.rustup"
CARGO_HOME="$DIR_CACHE/.cargo"

if [ ! -f "$CARGO_HOME/bin/rustup" ]; then
    echo "installing rustup"
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --profile minimal --default-toolchain nightly
    export PATH="$CARGO_HOME/bin":$PATH
fi

rustup self update
rustup update --no-self-update

pushd $DIR_BUILD

cargo build --release

ls -al $DIR_BUILD

popd
