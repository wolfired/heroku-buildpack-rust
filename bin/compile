#!/bin/sh

echo ">>>>> into compile shell"

DIR_BUILD=${1:-}
DIR_CACHE=${2:-}
DIR_ENV=${3:-}

echo DIR_BUILD=$DIR_BUILD
echo DIR_CACHE=$DIR_CACHE
echo DIR_ENV=$DIR_ENV

export RUSTUP_HOME="$DIR_CACHE/.rustup"
export CARGO_HOME="$DIR_CACHE/.cargo"

if [ ! -f "$CARGO_HOME/bin/rustup" ]; then
    echo "installing rustup"
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --profile minimal --default-toolchain nightly
fi

export PATH="$CARGO_HOME/bin":$PATH

rustup self update
rustup update --no-self-update

cd $DIR_BUILD

cargo build --release

ls -al $DIR_BUILD

cd ..
